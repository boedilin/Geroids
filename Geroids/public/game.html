<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Geroids</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/modernizr.js"></script>
    <script src="js/index.js"></script>
    <!--[if lte IE 9]>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.1.10/es5-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
<![endif]-->
    <script src="js/msgpack.min.js"></script>
    <script>
        // encode from JS Object to MessagePack (Uint8Array)

        var ws = new WebSocket("ws://" + location.host);
        ws.binaryType = 'arraybuffer';

        var decoder = msgpack.Decoder();

        decoder.on("data", function(data) {
            //console.log("in data event handler");
            // you'll receive 1, "leo", 2, "xxx-xxxx" and "yyy-yyyy" in order
            console.log(data);
        });
        decoder.on("end", function() {
            //console.log("end");
        });



        ws.onmessage = function(event) {
            console.log(new Uint8Array(event.data));
            decoder.decode(new Uint8Array(event.data));
            /*
            console.log(event.data);
            var raw_binary_data = new Uint8Array(event.data);
            buffer2 = new Uint8Array(event.data);
            console.log(raw_binary_data);
            var array = Array.from(buffer2)
            var message = msgpack.unpack(array);
            var message2 = msgpack.unpack(new Uint8Array(event.data));
            console.log(message);
            console.log(message2);*/
        };

        // kann generisch gemacht werden, da der Websocketserver der selbe ist, wie der
        // Server, der das HTML liefert:"ws://" + location.host

        ws.onopen = function() {
            console.log("Websocket opened!");
            if (localStorage.getItem('name') != null) {
                ws.send(localStorage.getItem('name'));
            }
        };

        /**
         * Upon Receiving a message from the server, this method tries to extract name attribute from string and send the message to the corresponding drawing method.
         */


        ws.onclose = function() {
            console.log("Closed!");
        };

        ws.onerror = function(err) {
            console.log("Error: " + err);
        };
    </script>

</head>

<body onload="startMusic()">
    <div id="gameoverbuttons">
        <div id="buttonsWrapper">
            <button id="gameoverbutton" onclick="location.href='game.html';">New Game</button>
            <button id="gameoverbutton" onclick="location.href='highScore.html';">High Scores</button>
            <button id="gameoverbutton" onclick="location.href='start.html';">Menu</button>
        </div>
    </div>
    <div id="appPanel">
        <canvas id="canvas"></canvas>
    </div>
</body>

</html>